{% extends "receipts/layout.html" %}

{% block head %}

<style>
.list-up-total-vision {
	display: flex;
	flex-direction: row;
	gap: 20px;
	margin: auto;
	font-family: 'Open Sans', sans-serif;
}
.listup-left-half {
	max-width: 40%;
	margin-left: 30px;
	overflow: scroll;
}
.listup-right-half {
	max-width: 60%;
	overflow: hidden;
}
.listup-table {
	padding: 0px;
	border: none;
	max-height: 100%;
	box-sizing: border-box;
}
.listup-table-frame {
	max-height: 23px;
}
.listup-table input[type="text"],
.listup-table input[type="boolean"],
.listup-table input[type="checkbox"] {
    height: 100%; 
    box-sizing: border-box; 
}
.listup-checkbox {
	text-align: center;
}
.listup-table-header {
	background-color: gray;
	color: white;
	font-weight: bold;
	text-align: center;
}
.listup-title {
	text-align: center;
}
.listup-table {
	border: 1px solid gray;
	border-collapse: collapse;
	/* width: 100%; */
    margin-right: 30px;
}
.listup-small {
	max-width: 100px;
}
.right-half-button {
    background-color: aqua;
    font-weight: 700;
    padding: 5px;
    border-radius: 10px;
    border: 3px solid blueviolet;
    margin-bottom: 5px;
}
.bg-gray {
    background-color: rgb(226, 226, 226);
    color: rgb(73, 61, 61);
}

</style>

{% endblock %}


{% block content %}

    <div class="list-up-total-vision">
        
        <div class="listup-left-half">
            
            <form method="post" action="{% url 'list_up_view' %}">
                {% csrf_token %}
                {{ items.management_form }}
                <select name="filtering" class="form-control" onchange="this.form.submit()">
                    <option value="2" {% if filtering == "2" %}selected{% endif %}>--</option>
                    <option value="2" {% if filtering == "2" %}selected{% endif %}>全て</option>
                    <option value="1" {% if filtering == "1" %}selected{% endif %}>取込済</option>
                    <option value="0" {% if filtering == "0" %}selected{% endif %}>未取込</option>
                </select>
                <!-- <input type="submit" value="Filter"> -->

                <table class="listup-table">
                    <thead>
                        <h2 class="listup-title">Table Title</h2>
                        <tr class="listup-table-header">
                            <th><a href="#" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="以下のセクションをクリックすると右に対応する画面が表示されます" style="color: white;">ファイル名</a></th>
                            <th class="listup-small">PDF番号</th>
                            <th class="listup-small"><a href="#" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="まだ【未処理=False】のものを選択して、右の「下記のレシートの入力へ進む」に行ってください。" style="color: white;">取込済</a></th>
                            <th style="width: 50px; background-color: brown;"><a href="#" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title="アップロードした画像を削除する場合にチェックボックスを入れて、下記の削除ボタンを押して下さい。" style="color: rgb(250, 250, 250);">削除</a></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if not items %}
                            <p>全て取込済です。</p>
                        {% else %}
                            {% for item in items %}
                            <tr class="listup-table-frame">
                                    <!-- <td><a href="#" onclick="showImage('{{ MEDIA_URL }}{{ item.upload }}'); return false;"> -->
                                        <td class="listup-table"><a href="#" onclick="updateRightSection('{{ item.id }}', '{{ MEDIA_URL }}{{ item.upload }}'); return false;">
                                            <input type="text" class="{% if item.processed == True %} bg-gray {% endif %}" name="date_field" value="{{ item.PDF_num }}" readonly>
                                        </a>
                                    </td>
                                    <td class="listup-table listup-small"><input type="text" class="listup-small {% if item.processed == True %} bg-gray {% endif %}" name="price_field" value="{{ item.id }}" readonly></td>
                                    <td class="listup-table listup-small"><input type="text" class="listup-small {% if item.processed == True %} bg-gray {% endif %}" name="processed_field" value="{{ item.processed }}" readonly></td>
                                    <td class="listup-table listup-checkbox"><input type="checkbox" name="delete_items" value="{{ item.id }}"></td>
                                
                            </tr>
                            {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
                
                
                <span class="alert">注意! 削除の場合のみ==></span> <button type="submit" style="margin-top: 20px; padding: 5px; border-radius: 10px;background-color: brown;"><a href="" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="アップロードしたファイルを削除したい場合はチェックボックスを入れボタンを押してください。" style="color: rgb(255, 255, 255);">削除</a></button>
                
            </form>
            
        </div>
        <div class="listup-right-half">
            {% if not items %}
                <p>全て取込済です。</p>
            {% else %}
                    <form id="navigateForm" method="GET" action="{% if items.first and items.first.id %}{% url 'input_view' id=items.first.id %}{% else %}#{% endif %}">
                        <label for="">PDF番号:</label>
                        <input type="text" name="id"  id="hiddenId" value="{{ items.first.id }}">
                        <input type="hidden" name="imageUrl" id="hiddenImageUrl" value="{{ MEDIA_URL }}{{ items.first.upload }}">
                        <button type="submit" class="right-half-button" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="下記のレシートをAI処理したのち、入力画面を表示させます。" style="color: black;">下記のレシートの入力へ進む</button>
                    </form>
                    <img id="displayImage" src="{{ MEDIA_URL }}{{ items.first.upload }}" alt="Image" style="max-width: 100%;">
            {% endif %}
        </div>
    </div>

    <script>

        function updateRightSection(id, imageUrl) {
        // Update the form hidden fields
        document.getElementById('hiddenId').value = id;
        document.getElementById('hiddenImageUrl').value = imageUrl;

        // Update the image display
        var imgElement = document.getElementById('displayImage');
        imgElement.src = imageUrl;

        // Update the form action URL with the new ID
        var form = document.getElementById('navigateForm');
        form.action = "{% url 'input_view' 0 %}".replace('0', id);
        
    }
    </script>

{% endblock %}

